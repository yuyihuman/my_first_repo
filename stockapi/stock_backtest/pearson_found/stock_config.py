#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
股票配置模块
提供对比股票列表等配置信息
"""

import os
import pandas as pd


def get_all_stocks_list():
    """
    获取所有A股股票列表（过滤掉8和9开头的股票）
    
    Returns:
        list: 股票代码列表
    """
    try:
        # 获取当前脚本所在目录
        current_dir = os.path.dirname(os.path.abspath(__file__))
        
        # 构建stock_data.csv文件路径（在stock_base_info目录下）
        stock_base_info_dir = os.path.join(current_dir, '..', '..', 'stock_base_info')
        csv_file = os.path.join(stock_base_info_dir, 'stock_data.csv')
        
        # 检查文件是否存在
        if not os.path.exists(csv_file):
            print(f"警告：找不到股票数据文件 {csv_file}")
            print("请先运行 stock_base_info/stock_data_fetcher.py 生成股票数据文件")
            return []
        
        # 读取CSV文件
        df = pd.read_csv(csv_file, encoding='utf-8')
        
        # 过滤掉8开头和9开头的股票（北交所等）
        # 确保股票代码是6位数字，然后检查第一位数字
        df['code_6digit'] = df['code'].astype(str).str.zfill(6)
        df = df[~df['code_6digit'].str[0].isin(['8', '9'])]
        
        # 只保留0、3、60开头的股票
        valid_stocks = []
        for _, row in df.iterrows():
            stock_code = str(row['code']).zfill(6)
            if stock_code.startswith('0') or stock_code.startswith('3') or stock_code.startswith('60'):
                valid_stocks.append(stock_code)
        
        return valid_stocks
        
    except Exception as e:
        print(f"获取股票列表时发生错误: {e}")
        return []


_ZZ500_CODES = [
    '000001','000002','000009','000032','000034','000035','000039','000063','000066','000069','000100','000157',
    '000301','000333','000338','000400','000408','000415','000423','000425','000426','000519','000538','000547',
    '000563','000568','000617','000623','000625','000629','000630','000651','000661','000683','000708','000725',
    '000733','000738','000768','000786','000792','000807','000818','000830','000831','000858','000878','000887',
    '000932','000933','000938','000960','000963','000967','000975','000977','000988','000998','000999','001914',
    '001965','001979','002001','002007','002008','002025','002027','002028','002044','002049','002050','002064',
    '002065','002074','002078','002085','002091','002120','002128','002129','002130','002131','002138','002145',
    '002152','002155','002156','002176','002179','002180','002185','002195','002202','002223','002230','002236',
    '002241','002244','002245','002252','002266','002271','002273','002281','002292','002294','002312','002318',
    '002340','002352','002353','002371','002372','002384','002389','002405','002407','002409','002410','002414',
    '002415','002422','002432','002436','002439','002444','002456','002459','002460','002463','002465','002466',
    '002472','002475','002493','002497','002508','002517','002532','002544','002555','002558','002572','002594',
    '002595','002601','002603','002607','002624','002625','002648','002709','002714','002738','002739','002756',
    '002812','002821','002831','002841','002916','002920','002938','003816','300001','300002','300003','300012',
    '300014','300015','300017','300024','300033','300037','300054','300058','300059','300068','300070','300073',
    '300088','300118','300122','300124','300136','300142','300144','300182','300207','300223','300251','300253',
    '300274','300285','300296','300308','300315','300316','300339','300346','300347','300383','300390','300394',
    '300395','300408','300413','300418','300433','300438','300442','300450','300454','300457','300459','300474',
    '300476','300496','300502','300529','300558','300567','300568','300573','300601','300604','300627','300628',
    '300661','300676','300699','300724','300750','300751','300757','300759','300760','300763','300769','300782',
    '300832','300866','300896','300919','301236','301358','301381','302132','600000','600004','600007','600008',
    '600009','600010','600011','600018','600019','600026','600028','600029','600030','600031','600036','600038',
    '600039','600048','600050','600066','600085','600089','600096','600104','600111','600115','600118','600129',
    '600131','600141','600143','600150','600153','600160','600161','600166','600170','600176','600177','600183',
    '600188','600196','600208','600219','600233','600256','600258','600276','600309','600312','600315','600316',
    '600323','600325','600332','600335','600346','600352','600362','600372','600392','600398','600406','600415',
    '600418','600426','600436','600438','600460','600482','600486','600487','600489','600497','600498','600499',
    '600511','600515','600516','600519','600521','600529','600535','600547','600549','600563','600570','600584',
    '600585','600588','600637','600655','600660','600667','600674','600690','600699','600704','600741','600745',
    '600754','600760','600763','600765','600795','600803','600820','600839','600845','600859','600862','600864',
    '600867','600879','600885','600886','600887','600893','600895','600900','600905','600919','600938','600941',
    '600988','600989','600998','601000','601006','601012','601018','601021','601058','601088','601100','601111',
    '601117','601127','601155','601166','601168','601179','601186','601216','601225','601233','601238','601288',
    '601318','601319','601328','601360','601390','601398','601567','601600','601601','601607','601615','601618',
    '601628','601633','601636','601658','601668','601669','601677','601689','601727','601728','601766','601799',
    '601800','601816','601857','601866','601868','601872','601877','601880','601888','601899','601919','601966',
    '601985','601988','603000','603019','603077','603087','603129','603259','603260','603288','603392','603486',
    '603501','603568','603596','603605','603606','603613','603650','603659','603799','603806','603816','603833',
    '603885','603899','603939','603979','603986','603993','605117','605358','605499','605589','688002','688005',
    '688008','688009','688012','688036','688041','688047','688063','688072','688099','688111','688120','688122',
    '688126','688169','688180','688188','688213','688223','688235','688256','688266','688271','688303','688390',
    '688396','688506','688578','688599','688608','688617','688777','688981'
]


def get_comparison_stocks(mode='top10'):
    """
    获取对比股票列表
    
    Args:
        mode: 对比模式 ('top10', 'hs300', 'zz500', 'top1000', 'top1500', 'custom', 'self_only', 'all')
    
    Returns:
        list: 股票代码列表
    """
    
    if mode == 'top10':
        # 市值前10的股票代码
        return [
            '000001', '000002', '002001', '002230', '002594', 
            '600000', '600036', '600519', '600887', '601169'
        ]
    
    elif mode == 'hs300':
        # 沪深300成分股（示例列表，后续可替换为实时成分）
        return [
            '000001', '000002', '000063', '000100', '000157',
            '000301', '000338', '000408', '000425', '000538',
            '000568', '000596', '000617', '000625', '000630',
            '000651', '000661', '000708', '000725', '000768',
            '000776', '000786', '000792', '000800', '000807',
            '000858', '000876', '000895', '000938', '000963',
            '000975', '000977', '000983', '000999', '002001',
            '002027', '002028', '002049', '002050', '002074',
            '002129', '002142', '002179', '002180', '002230',
            '002236', '002241', '002252', '002304', '002311',
            '002352', '002371', '002415', '002422', '002459',
            '002460', '002463', '002466', '002475', '002493',
            '300014', '300015', '300033', '300059', '300122',
            '300124', '302132', '600000', '600009', '600010',
            '600011', '600015', '600016', '600018', '600019',
            '600026', '600027', '600028', '600029', '600030',
            '600031', '600036', '600039', '600048', '600050',
            '600061', '600066', '600085', '600089', '600104',
            '600111', '600115', '600150', '600160', '600161',
            '600176', '600183', '600188', '600196', '600219',
            '600233', '600276', '600309', '600332', '600346',
            '600362', '600372', '600377', '600406', '600415',
            '600426', '600436', '600438', '600460', '600482',
            '600489', '600515', '600519', '600547', '600570',
            '600584', '600585', '600588', '600600', '600660',
            '600674', '600690', '600741', '600760', '600795',
            '600803', '600809', '600845', '600875', '600886',
            '600887', '600893', '600900', '600999', '601006',
            '601009', '601088', '601111', '601117', '601166',
            '601169', '601186', '601288', '601318', '601328',
            '601377', '601390', '601398', '601600', '601601',
            '601607', '601618', '601628', '601668', '601688',
            '601699', '601766', '601788', '601808', '601818',
            '601857', '601872', '601877', '601888', '601898',
            '601899', '601919', '601939', '601988', '601998'
        ]
    
    elif mode == 'top1000':
        # 与 all 模式一致的数据来源与过滤，选取前1000个
        return get_top_n_stocks_from_all(1000)
    
    elif mode == 'top1500':
        # 与 all 模式一致的数据来源与过滤，选取前1500个
        return get_top_n_stocks_from_all(1500)

    elif mode == 'zz500':
        # 中证500成分股（常量列表）
        return _ZZ500_CODES
    
    elif mode == 'self_only':
        # 仅自身对比，返回空列表
        return []
    
    elif mode == 'custom':
        # 自定义模式，返回空列表，由调用者提供股票列表
        return []
    
    elif mode == 'all':
        # 所有A股股票模式，返回所有有效的股票代码
        return get_all_stocks_list()
    
    else:
        # 默认返回top10
        return get_comparison_stocks('top10')


def get_stock_industry(stock_code):
    """
    获取股票所属行业
    
    Args:
        stock_code: 股票代码
    
    Returns:
        str: 行业名称
    """
    # 这里应该从数据库或API获取真实的行业信息
    # 暂时返回示例数据
    industry_map = {
        '000001': '银行',
        '000002': '房地产',
        '600036': '银行',
        '600519': '食品饮料',
        '000858': '有色金属',
        '002415': '通信设备'
    }
    
    return industry_map.get(stock_code, '未知行业')


def get_top_n_stocks_from_all(n):
    """
    从与 all 模式一致的数据源（stock_base_info/stock_data.csv）读取过滤后的股票列表，返回前 n 个。
    过滤规则：排除以 8、9 开头，仅保留以 0、3、60 开头。
    """
    try:
        stocks = get_all_stocks_list()
        if not stocks:
            return []
        return stocks[:n]
    except Exception as e:
        print(f"读取前{n}个股票时发生错误: {e}")
        return []